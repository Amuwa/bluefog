

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bluefog Timeline &mdash; Bluefog  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Spectrum of Distributed Machine Learning Algorithm" href="alg_spectrum.html" />
    <link rel="prev" title="Bluefog Rationale" href="rationale.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Bluefog
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing Bluefog</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="torch_api.html">Bluefog Torch API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorflow_api.html">Bluefog Tensorflow API</a></li>
<li class="toctree-l1"><a class="reference internal" href="topo_api.html">Bluefog Topology API</a></li>
</ul>
<p class="caption"><span class="caption-text">More Information</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bluefog_ops.html">Bluefog Ops Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Lauching Application Through bfrun</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Bluefog Docker Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Bluefog Perform Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="rationale.html">Bluefog Rationale</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Bluefog Timeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-i-logistic-regression-with-neighbor-allreduce">Example I: Logistic regression with neighbor_allreduce</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-ii-logistic-regression-with-win-accumulate">Example II: Logistic regression with win_accumulate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-iii-resnet-training-with-one-sided-communication">Example III: Resnet training with one-sided communication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alg_spectrum.html">Spectrum of Machine Learning Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_structure.html">Codebase Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel_guide.html">Development Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Bluefog</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Bluefog Timeline</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/timeline.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bluefog-timeline">
<h1>Bluefog Timeline<a class="headerlink" href="#bluefog-timeline" title="Permalink to this headline">¶</a></h1>
<p>Bluefog timeline is used to record all activities occurred during your distributed training
process. With Bluefog timeline, you can understand the performance of your training
algorithm, indentify the bottleneck, and then improve it.</p>
<p>The development of Bluefog timeline is based on the <a class="reference external" href="https://github.com/horovod/horovod/blob/master/docs/timeline.rst">Horovod timeline</a>. Similar to Horovod,
Bluefog timeline clearly visualizes the start and end of all communication stages between
agents such as <code class="docutils literal notranslate"><span class="pre">allreduce</span></code>, <code class="docutils literal notranslate"><span class="pre">broadcast</span></code>, <code class="docutils literal notranslate"><span class="pre">neighbor_allreduce</span></code>, <code class="docutils literal notranslate"><span class="pre">win_put</span></code>,
<code class="docutils literal notranslate"><span class="pre">win_accumulate</span></code> and many others. Some of these communication primitives are exclusive
to Bluefog.</p>
<p>An enhanced feature of Bluefog timeline is to visualize the computation states of each
agent such as <code class="docutils literal notranslate"><span class="pre">forward</span> <span class="pre">propogation</span></code> and <code class="docutils literal notranslate"><span class="pre">backward</span> <span class="pre">propogation</span></code>. The visualization of both
communication and computation will help a better understanding of your training algorithm.
For example, Bluefog timeline will tell how your computation is in parallel with the
communication.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>To record a Bluefog timeline, set <code class="docutils literal notranslate"><span class="pre">--timeline-filename</span></code> command line argument to the
location of the timeline file to be created. This will generate a timeline record file
for each agent. For example, the following command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bfrun -np 4 --timeline-filename /path/to/timeline_filename python example.py
</pre></div>
</div>
<p>will generate four timeline files: <code class="docutils literal notranslate"><span class="pre">timeline_filename0.json</span></code>, <code class="docutils literal notranslate"><span class="pre">timeline_filename1.json</span></code>,
<code class="docutils literal notranslate"><span class="pre">timeline_filename2.json</span></code>, and <code class="docutils literal notranslate"><span class="pre">timeline_filename3.json</span></code>, and each json file is for
a different agent. You can then load the timeline file into the
<a class="reference external" href="chrome://tracing/">chrome://tracing</a> facility of the Chrome browser. If the operation <code class="docutils literal notranslate"><span class="pre">--timeline-filename</span></code>
is not set, the timeline function will be deactivated by default.</p>
</div>
<div class="section" id="example-i-logistic-regression-with-neighbor-allreduce">
<h2>Example I: Logistic regression with neighbor_allreduce<a class="headerlink" href="#example-i-logistic-regression-with-neighbor-allreduce" title="Permalink to this headline">¶</a></h2>
<p>In the first example, we show the timeline when running decentralized SGD for
logistic regression, see the figure below. In this example, each rank is connected
via an undirected power-2 topology. We exploit the
primitive <code class="docutils literal notranslate"><span class="pre">neighbor_allreduce</span></code> to perform the neighbor averaging.</p>
<a class="reference internal image-reference" href="_images/bf_timeline_example1a.png"><img alt="_images/bf_timeline_example1a.png" class="align-center" src="_images/bf_timeline_example1a.png" style="width: 800px;" /></a>
<p>There are two active threads in the timeline: thread 1 that is mainly for gradient
<strong>computation</strong> and thread 2 for <strong>communication</strong>. There is a phase <code class="docutils literal notranslate"><span class="pre">MPI_NEIGHBOR_ALLREDUCE</span></code>
in thread 2 when neighbor allreduce actually happens. It is further divided into multiple
sub-phases:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ALLOCATE_OUTPUT</span></code>: indicates the time taken to allocate the temporary memory for neighbor’s tensor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMMUNICATE</span></code> indicates the time taken to perform the actual communication operation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPUTE_AVERAGE</span></code> indicates the time taken to compuate the average of variables received from neighbors. It is basically a reduce operation.</p></li>
</ul>
</div></blockquote>
<p>Another notable feature of this neighbor_allreduce timeline is that threads 1 and 2 are <strong>synchronized</strong>.
Each time when thread 1 enqueues a task for thread 2 to conduct communication, it will be blocked until
thread 2 finish communication. As a result, it is observed that the end of opeartion <code class="docutils literal notranslate"><span class="pre">ENQUEUE_NEIGHBOR_ALLREDUCE</span></code>
in thread 1 aligns with the end of opeartion <code class="docutils literal notranslate"><span class="pre">MPI_NEIGHBOR_ALLREDUCE</span></code> in thread 2.</p>
</div>
<div class="section" id="example-ii-logistic-regression-with-win-accumulate">
<h2>Example II: Logistic regression with win_accumulate<a class="headerlink" href="#example-ii-logistic-regression-with-win-accumulate" title="Permalink to this headline">¶</a></h2>
<p>In this example, we still show the timeline when running decentralized SGD for
logistic regression. Different from Example I, we employ the one-sided communication
primitives <code class="docutils literal notranslate"><span class="pre">win_accumulate</span></code> to exchange information between neighboring ranks.</p>
<a class="reference internal image-reference" href="_images/bf_timeline_example2.png"><img alt="_images/bf_timeline_example2.png" class="align-center" src="_images/bf_timeline_example2.png" style="width: 800px;" /></a>
<p>Different from Example I, it is observed that the computation thread (thread 1) and
the communication thread (thread 2) were running independently. Thread 1 will not
be blocked after enqueuing the <code class="docutils literal notranslate"><span class="pre">WIN_ACCUMULATE</span></code> task to thread 2 (<code class="docutils literal notranslate"><span class="pre">ENQUEUE_WIN_ACCUMULATE</span></code> in
thread 1 and <code class="docutils literal notranslate"><span class="pre">MPI_WIN_ACCUMULATE</span></code> in thread 2 are not aligned). In other words,
the one-sided communication primitive enables nonblocking operation and will significantly
improve the training efficiency in real practice.</p>
</div>
<div class="section" id="example-iii-resnet-training-with-one-sided-communication">
<h2>Example III: Resnet training with one-sided communication<a class="headerlink" href="#example-iii-resnet-training-with-one-sided-communication" title="Permalink to this headline">¶</a></h2>
<p>In this example, we show the timeline for a real experiment when decentralized SGD is used to
train Resnet with CIFAR10 dataset. We exploit the one-sided communicaton primitive <code class="docutils literal notranslate"><span class="pre">win_put</span></code>
to exchange information between ranks. It is observed that each phase during the training
is clearly illustrated in the timeline.</p>
<a class="reference internal image-reference" href="_images/bf_timeline_example3.png"><img alt="_images/bf_timeline_example3.png" class="align-center" src="_images/bf_timeline_example3.png" style="width: 800px;" /></a>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="alg_spectrum.html" class="btn btn-neutral float-right" title="The Spectrum of Distributed Machine Learning Algorithm" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rationale.html" class="btn btn-neutral float-left" title="Bluefog Rationale" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Bicheng Ying

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>