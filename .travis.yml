language: python
python:
    - "3.7"

os: linux

addons:
    apt:
      update: true
    homebrew:
      update: true

before_install:
    - ./scripts/install_mpi.sh mpich
    - pip install torch sphinx sphinx_rtd_theme

install:
    - pip install .
    - python setup.py build_ext -i

script:
    - make test
    - cd docs && make html
    - touch _build/html/.nojekyll

deploy:
    provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
    keep_history: true
    local_dir: docs/_build/html/
    on:
        branch: master
