language: python

notifications:
    email:
        - hanbinhu2016@gmail.com

matrix:
    include:
        - os: linux
          python: 3.7
          env: MPI=openmpi
        - os: linux
          python: 3.7
          env: MPI=mpich
        - os: osx
          env: MPI=openmpi
        - os: osx
          env: MPI=mpich

cache:
    apt: true

addons:
    apt:
        update: true
    homebrew:
        update: true

before_install:
    - ./scripts/install_mpi.sh $MPI
    - pip install torch tensorflow

install:
    - pip install .

script:
    - mv bluefog _bluefog  # Force to use installed package instead of local one
    - make test

# Build and deploy the doc through the sphinx.
before_deploy:
    - pip install sphinx sphinx_rtd_theme
    - cd docs && make html
    - touch _build/html/.nojekyll

deploy:
    provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
    keep_history: true
    local_dir: docs/_build/html/
    on:
        branch: master
