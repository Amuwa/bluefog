

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bluefog &mdash; Bluefog  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installing Bluefog" href="install.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home" alt="Documentation Home"> Bluefog
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing Bluefog</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="torch_api.html">Bluefog Torch API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorflow_api.html">Bluefog Tensorflow API</a></li>
<li class="toctree-l1"><a class="reference internal" href="topo_api.html">Bluefog Topology API</a></li>
</ul>
<p class="caption"><span class="caption-text">More Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bluefog_ops.html">Bluefog Ops Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Lauching Application Through bfrun</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Bluefog Docker Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Bluefog Perform Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="rationale.html">Bluefog Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="timeline.html">Bluefog Timeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="alg_spectrum.html">Spectrum of Machine Learning Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_structure.html">Codebase Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel_guide.html">Development Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Bluefog</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>Bluefog</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bluefog">
<h1>Bluefog<a class="headerlink" href="#bluefog" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="_images/bf_logo_h.png"><img alt="Bluefog Logo" class="align-center" src="_images/bf_logo_h.png" style="width: 450px;" /></a>
<p>Bluefog is a distributed training framework for PyTorch based
on diffusion/consensus-type algorithm.
The goal of Bluefog is to make distributed and decentralized machine learning fast,
fault-tolerant, friendly to heterogeneous environment, and easy to use.</p>
<p>The most distinguishable feature of Bluefog compared with other popular distributed training frameworks, such as
DistributedDataParallel provided by pytorch, Horovod, BytePS, etc., is that our core implementation rooted on the idea
that we introduce the virtual topology into the multiple processes and local averaging will converge to the global average
as iteration keep going, where local averaging is defined based on the connection in the virtual topology.</p>
<p>Leveraging the <em>One-sided Communication Ops</em> (i.e. remote-memory access) of MPI, Bluefog is not only distributed
but also decentralized training framework with high performance.</p>
<ul class="simple">
<li><p>Unlike the <em>ring-allreduce</em> based Bulk Synchronous Parallel algorithm, each process in bluefog is highly decoupled so that we can maximize the power of asynchronous algorithm.</p></li>
<li><p>Unlike the <em>parameter-server</em> (PS) based architecture, there is no central node to collect and distribute information so that we can avoid the bottleneck problem existing in the PS.</p></li>
</ul>
<p>The cost of those advantages is the inconsistence between models. Please check our papers to see the theoratical guarantee.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Although the most torch-based APIs perform well, this repository is still
in the early stage of development and more features are waiting to be implemented.
If you are interested, you are more than welcome to join us and contribute this project!</p>
</div>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>First, make sure your environment is with <code class="docutils literal notranslate"><span class="pre">python&gt;=3.7</span></code> and <a class="reference external" href="https://www.open-mpi.org/">openmpi</a> &gt;= 4.0.
Then, install Bluefog with: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--no-cache-dir</span> <span class="pre">bluefog</span></code>.  Check
the <a class="reference internal" href="install.html#install-bluefog"><span class="std std-ref">Installing Bluefog</span></a> page if you need more information or other install options.
We provide high-level wrapper for torch optimizer.
Probably, the only thing you need to modify
the existing script to distributed implementation is wrapping the optimizer
with our <code class="docutils literal notranslate"><span class="pre">DistributedBluefogOptimizer</span></code>,
then run it through <code class="docutils literal notranslate"><span class="pre">bfrun</span></code>. That is it!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute Python functions in parallel through</span>
<span class="c1"># bfrun -np 4 python file.py</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">bluefog.torch</span> <span class="k">as</span> <span class="nn">bf</span>
<span class="o">...</span>
<span class="n">bf</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span> <span class="o">*</span> <span class="n">bf</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">DistributedBluefogOptimizer</span><span class="p">(</span>
   <span class="n">optimizer</span><span class="p">,</span> <span class="n">model</span>
<span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>We also provide lots of low-level functions, which you can use those as building
blocks to construct your own distributed trainning algorithm. The following example
illustrates how to run a simple consensus algorithm through bluefog.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">bluefog.torch</span> <span class="k">as</span> <span class="nn">bf</span>

<span class="n">bf</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="n">bf</span><span class="o">.</span><span class="n">rank</span><span class="p">()])</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">neighbor_allreduce</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bf</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="si">}</span><span class="s2">: Average value of all ranks is </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>One noteable feature of Bluefog is that we leverage the One-sided Communication of MPI
to build a real decentralized and asynchronized algorithms. This is another example about
how to use Bluefog to implement an asynchronized push-sum consensus algorithm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">bluefog.torch</span> <span class="k">as</span> <span class="nn">bf</span>
<span class="kn">from</span> <span class="nn">bluefog.common</span> <span class="kn">import</span> <span class="n">topology_util</span>

<span class="n">bf</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># Setup the topology for communication</span>
<span class="n">bf</span><span class="o">.</span><span class="n">set_topology</span><span class="p">(</span><span class="n">topology_util</span><span class="o">.</span><span class="n">PowerTwoRingGraph</span><span class="p">(</span><span class="n">bf</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
<span class="n">outdegree</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bf</span><span class="o">.</span><span class="n">out_neighbor_ranks</span><span class="p">())</span>
<span class="n">indegree</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bf</span><span class="o">.</span><span class="n">in_neighbor_ranks</span><span class="p">())</span>

<span class="c1"># Create the buffer for neighbors.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="n">bf</span><span class="o">.</span><span class="n">rank</span><span class="p">(),</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">bf</span><span class="o">.</span><span class="n">win_create</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;x_buff&quot;</span><span class="p">,</span> <span class="n">zero_init</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
   <span class="n">bf</span><span class="o">.</span><span class="n">win_accumulate</span><span class="p">(</span>
      <span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;x_buff&quot;</span><span class="p">,</span>
      <span class="n">dst_weights</span><span class="o">=</span><span class="p">{</span><span class="n">rank</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">outdegree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="n">bf</span><span class="o">.</span><span class="n">out_neighbor_ranks</span><span class="p">()},</span>
      <span class="n">require_mutex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="n">x</span><span class="o">.</span><span class="n">div_</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">outdegree</span><span class="p">)</span>
   <span class="n">bf</span><span class="o">.</span><span class="n">win_update_then_collect</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;x_buff&quot;</span><span class="p">)</span>

<span class="n">bf</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="c1"># Do not forget to sync at last!</span>
<span class="n">bf</span><span class="o">.</span><span class="n">win_update_then_collect</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;x_buff&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bf</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="si">}</span><span class="s2">: Average value of all ranks is </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Please explore our <a class="reference external" href="https://github.com/ybc1991/bluefog/tree/master/examples">examples</a> folder to see more about
how to implemented deep learning trainning and distributed
optimization algorithm quickly and easily through bluefog. If you want to understand more on
how to use the low-level API as the building blocks for your own distributed
algorithm, please read our <a class="reference internal" href="bluefog_ops.html#ops-explanation"><span class="std std-ref">Bluefog Operations Explanation</span></a> page.</p>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing Bluefog</a></li>
</ul>
</div>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="torch_api.html">Bluefog Torch API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorflow_api.html">Bluefog Tensorflow API</a></li>
<li class="toctree-l1"><a class="reference internal" href="topo_api.html">Bluefog Topology API</a></li>
</ul>
</div>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">More Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bluefog_ops.html">Bluefog Ops Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Lauching Application Through bfrun</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Bluefog Docker Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Bluefog Perform Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="rationale.html">Bluefog Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="timeline.html">Bluefog Timeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="alg_spectrum.html">Spectrum of Machine Learning Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_structure.html">Codebase Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel_guide.html">Development Guide</a></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="install.html" class="btn btn-neutral float-right" title="Installing Bluefog" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Bicheng Ying

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>